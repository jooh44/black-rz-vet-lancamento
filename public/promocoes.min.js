const productsGrid=document.querySelector("#products-grid"),currentYearEl=document.querySelector("#current-year"),countdownControllers=new WeakMap,COUNTDOWN_TIME_ZONE="America/Sao_Paulo";let mobileDeviceCache=null;function isMobileDevice(){if(null!==mobileDeviceCache)return mobileDeviceCache;if(window.matchMedia&&window.matchMedia("(max-width: 767px)").matches)return mobileDeviceCache=!0,!0;if(window.innerWidth&&window.innerWidth<768)return mobileDeviceCache=!0,!0;const e=navigator.userAgent||navigator.vendor||window.opera;return/android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(e.toLowerCase())?(mobileDeviceCache=window.innerWidth<768,mobileDeviceCache):(mobileDeviceCache=!1,!1)}function getTimeZoneOffsetMs(e,t){const r=new Intl.DateTimeFormat("en-US",{timeZone:t,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hourCycle:"h23"}).formatToParts(e).reduce((e,t)=>("literal"!==t.type&&(e[t.type]=t.value),e),{});return Date.UTC(Number(r.year),Number(r.month)-1,Number(r.day),Number(r.hour),Number(r.minute),Number(r.second))-e.getTime()}function parseCountdownTarget(e,t){if(!e)return null;const r=e.trim();if(!r)return null;if(/([zZ]|[+-]\d\d:\d\d)$/.test(r)){const e=new Date(r);return Number.isNaN(e.getTime())?null:e}const[o,n="00:00:00"]=r.replace(/\s+/,"T").split("T");if(!o)return null;const[a,i="01",c="01"]=o.split("-"),[s="00",l="00",d="00"]=n.split(":"),u=[Number(a),Number(i),Number(c),Number(s),Number(l),Number(d)];if(u.some(e=>Number.isNaN(e)))return null;const[m,p,h,b,w,g]=u,v=new Date(Date.UTC(m,p-1,h,b,w,g)),f=getTimeZoneOffsetMs(v,t);return new Date(v.getTime()-f)}function initializeCountdowns(){const e=document.querySelectorAll("[data-target-date]");e.length&&e.forEach(e=>{if(countdownControllers.has(e))return;const t=e.dataset.targetDate;if(!t)return;const r=parseCountdownTarget(t,"America/Sao_Paulo");if(Number.isNaN(r.getTime()))return;const o={days:e.querySelector('[data-countdown-part="days"]'),hours:e.querySelector('[data-countdown-part="hours"]'),minutes:e.querySelector('[data-countdown-part="minutes"]'),seconds:e.querySelector('[data-countdown-part="seconds"]')};if(!Object.values(o).every(Boolean))return;function n(e,t=2){return String(Math.max(0,e)).padStart(t,"0")}function a(){const t=new Date;let a=r.getTime()-t.getTime();a<0&&(a=0);const i=Math.floor(a/1e3),c=Math.floor(i/86400),s=Math.floor(i%86400/3600),l=Math.floor(i%3600/60),d=i%60;if(o.days.textContent=n(c,2),o.hours.textContent=n(s),o.minutes.textContent=n(l),o.seconds.textContent=n(d),e.dataset.countdownState=0===a?"finished":"running",e.setAttribute("aria-label",0===a?"Evento iniciado":`Faltam ${c} dias, ${s} horas, ${l} minutos e ${d} segundos`),0===a){const t=countdownControllers.get(e);t&&window.clearInterval(t)}}a();const i=window.setInterval(a,1e3);countdownControllers.set(e,i)})}function formatPrice(e){return new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL",minimumFractionDigits:2}).format(e)}function getProductImagePath(e,t=!1){const r=`/products-images/${t?"Insumos":"Equipamentos"}`,o={"monitor-rm1200":"RM1200.webp","aparelho-anestesia-vp1000":"VP1000.webp","monitor-rm-700":"RM700.webp","monitor-re700":"RE700.webp","monitor-portatil-r1000":"R1000.webp","monitor-portatil-r200":"R200.webp","bomba-de-seringa-m200a":"M200A.webp","kit-4-bomba-de-seringa":"KIT M200 A WORK.webp","vent-pet-2.0":"VENTPET.webp","central-de-controle-workstation":"workstation_central_de_controle_m200a_ewm200a_595_1_20ab4ea2bacafe1feb3c4bbbc0041310.webp",neurostim:"NEUROSTIM.webp",oximetro:"OXIMETRO.webp","agulha-tuohy-16g-18g-90mm":"AGULHA TUOHY 16 18.webp","agulha-tuohy-20g-90mm":"AGULHA TUOHY 20X90G.webp","agulha-tuohy-20g-50mm":"AGULHA TUOHY 20X50G.webp","agulha-tuohy-22g-50mm":"AGULHA TUOHY 22X50G.webp","agulha-tuohy-17g-90mm":"AGULHA TUOHY 17.webp","agulha-bloqueio-periferico-21g-100mm":"AGULHA BLOQUEIO 100MM.webp","agulha-bloqueio-periferico-22g-50mm":"AGULHA BLOQUEIO 50MM.webp","multi-injetor-linear-3-aplicadores":"multi injetor 3.webp","balao-latex-reinalacao-250ml":"BALAO 250ML.webp","balao-latex-reinalacao-500ml":"BALAO 500ML.webp","balao-latex-reinalacao-1litro":"BALAO 1 , 2 ,3.webp","balao-latex-reinalacao-2litros":"BALAO 1 , 2 ,3.webp","balao-latex-reinalacao-3litros":"BALAO 1 , 2 ,3.webp","cateter-venoso-central-4fr-5fr":"cateter venoso.webp","cateter-venoso-central-7fr":"cateter venoso.webp","reanimador-manual-ambu":"AMBU.webp","kit-cabo-ecg-03-vias-03-garras":"CABO ECG 3 VIAS.webp","canula-gato-no03-3-5kg":"CANULA GATO.webp","canula-coelho-no02-no03":"CANULA COELHO.webp","atadura-elastica-5cm":"ATADURAS 5 CM.webp","atadura-elastica-10cm":"ATADURAS 10 CM.webp"},n=o[e.id]||o[e.slug];return n?`${r}/${n}`:e.image||`${r}/placeholder.webp`}function handleImageError(e){const t=e.parentElement?.querySelector(".product-card__image-placeholder");t&&(e.style.display="none",t.style.display="flex")}function createProductCard(e,t=!1,r=0){const o=document.createElement("article");o.className="product-card",o.setAttribute("role","listitem"),o.setAttribute("aria-label",`Produto ${e.name}`);const n=e.discount_percentage?`<div class="product-card__badge" aria-label="Desconto de ${e.discount_percentage}%">\n         <span class="product-card__badge-text">-${e.discount_percentage}%</span>\n       </div>`:"",a=e.price_original?`<span class="product-card__price-original" aria-label="Preço original ${formatPrice(e.price_original)}">\n         ${formatPrice(e.price_original)}\n       </span>`:"",i=e.specifications&&e.specifications.length>0?`<ul class="product-card__specs" aria-label="Especificações do produto">\n         ${e.specifications.map(e=>`<li>${e}</li>`).join("")}\n       </ul>`:"",c=getProductImagePath(e,t);o.innerHTML=`\n    <div class="product-card__image-wrapper">\n      <img \n        src="${c}" \n        alt="${e.name}" \n        class="product-card__image"\n        loading="eager"\n        decoding="async"\n        width="400"\n        height="300"\n        fetchpriority="high"\n      />\n      <div class="product-card__image-placeholder" style="display: none;" aria-hidden="true">\n        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">\n          <rect x="3" y="3" width="18" height="18" rx="2" />\n          <path d="M9 9h6v6H9z" />\n        </svg>\n      </div>\n      ${n}\n    </div>\n    <div class="product-card__content">\n      <h3 class="product-card__title">${e.name}</h3>\n      ${e.description?`<p class="product-card__description">${e.description}</p>`:""}\n      <div class="product-card__pricing">\n        ${a}\n        <span class="product-card__price-promotional" aria-label="Preço promocional ${formatPrice(e.price_promotional)}">\n          ${formatPrice(e.price_promotional)}\n        </span>\n      </div>\n      ${i}\n      <a \n        href="${e.url}" \n        target="_blank" \n        rel="noopener noreferrer"\n        class="product-card__button btn-ver-produto"\n        aria-label="Ver detalhes do produto ${e.name}"\n        data-product-id="${e.id}"\n        data-product-name="${e.name}"\n      >\n        Ver Produto\n      </a>\n    </div>\n  `;const s=o.querySelector(".product-card__image");return s&&s.addEventListener("error",()=>handleImageError(s)),o}async function loadProducts(){try{const t=await fetch("/data/products.json");if(!t.ok)throw new Error("Falha ao carregar produtos");const r=(await t.json()).filter(e=>e.available);if(!productsGrid)return;if(0===r.length)return void(productsGrid.innerHTML='\n        <div class="products-empty" role="alert">\n          <p>Produtos temporariamente indisponíveis.</p>\n        </div>\n      ');productsGrid.innerHTML="";const o=6,n=4;r.slice(0,o).forEach((e,t)=>{const r=createProductCard(e,!1,t);productsGrid.appendChild(r)});const a=r.slice(o);let i=0;function e(){a.slice(i,i+n).forEach((e,t)=>{const r=createProductCard(e,!1,o+i+t);productsGrid.appendChild(r)}),i+=n,i<a.length&&(window.requestIdleCallback?window.requestIdleCallback(e,{timeout:100}):setTimeout(e,0))}a.length>0&&(window.requestIdleCallback?window.requestIdleCallback(e,{timeout:100}):requestAnimationFrame(()=>{setTimeout(e,0)})),void 0!==window.fbq&&window.fbq("track","ViewContent",{content_name:"Black Days RZ VET - Produtos",content_category:"Equipamentos Veterinários",content_type:"product",content_ids:r.map(e=>e.id),num_items:r.length});const c=new IntersectionObserver(e=>{e.forEach(e=>{if(e.isIntersecting){const t=e.target,r=t.querySelector(".btn-ver-produto")?.dataset.productId,o=t.querySelector(".btn-ver-produto")?.dataset.productName;r&&!t.dataset.tracked&&(t.dataset.tracked="true",void 0!==window.fbq&&window.fbq("track","ViewContent",{content_name:o,content_ids:[r],content_type:"product",content_category:"Equipamentos Veterinários"}))}})},{threshold:.1,rootMargin:"50px"});productsGrid.querySelectorAll(".product-card").forEach(e=>{c.observe(e)}),productsGrid.querySelectorAll(".btn-ver-produto").forEach(e=>{e.addEventListener("click",t=>{const r=e.dataset.productId,o=e.dataset.productName;void 0!==window.fbq&&(window.fbq("track","Lead",{content_name:o,content_ids:[r],content_type:"product",content_category:"Equipamentos Veterinários"}),window.fbq("track","InitiateCheckout",{content_name:o,content_ids:[r],content_type:"product"}))})})}catch(s){productsGrid&&(productsGrid.innerHTML='\n        <div class="products-error" role="alert">\n          <p>Erro ao carregar produtos. Por favor, recarregue a página.</p>\n        </div>\n      ')}}async function loadAccessories(){try{const t=await fetch("/data/accessories.json");if(!t.ok)throw new Error("Falha ao carregar acessórios");const r=(await t.json()).filter(e=>e.available),o=document.querySelector("#accessories-grid");if(!o)return;if(0===r.length)return void(o.innerHTML='\n        <div class="products-empty" role="alert">\n          <p>Acessórios temporariamente indisponíveis.</p>\n        </div>\n      ');o.innerHTML="";const n=6,a=4;r.slice(0,n).forEach((e,t)=>{const r=createProductCard(e,!0,t);o.appendChild(r)});const i=r.slice(n);let c=0;function e(){i.slice(c,c+a).forEach((e,t)=>{const r=createProductCard(e,!0,n+c+t);o.appendChild(r)}),c+=a,c<i.length&&(window.requestIdleCallback?window.requestIdleCallback(e,{timeout:100}):setTimeout(e,0))}i.length>0&&(window.requestIdleCallback?window.requestIdleCallback(e,{timeout:100}):requestAnimationFrame(()=>{setTimeout(e,0)})),void 0!==window.fbq&&window.fbq("track","ViewContent",{content_name:"Black Days RZ VET - Acessórios",content_category:"Acessórios Veterinários",content_type:"product",content_ids:r.map(e=>e.id),num_items:r.length});const s=new IntersectionObserver(e=>{e.forEach(e=>{if(e.isIntersecting){const t=e.target,r=t.querySelector(".btn-ver-produto")?.dataset.productId,o=t.querySelector(".btn-ver-produto")?.dataset.productName;r&&!t.dataset.tracked&&(t.dataset.tracked="true",void 0!==window.fbq&&window.fbq("track","ViewContent",{content_name:o,content_ids:[r],content_type:"product",content_category:"Acessórios Veterinários"}))}})},{threshold:.1,rootMargin:"50px"});o.querySelectorAll(".product-card").forEach(e=>{s.observe(e)}),o.querySelectorAll(".btn-ver-produto").forEach(e=>{e.addEventListener("click",t=>{const r=e.dataset.productId,o=e.dataset.productName;void 0!==window.fbq&&(window.fbq("track","Lead",{content_name:o,content_ids:[r],content_type:"product",content_category:"Acessórios Veterinários"}),window.fbq("track","InitiateCheckout",{content_name:o,content_ids:[r],content_type:"product"}))})})}catch(l){const d=document.querySelector("#accessories-grid");d&&(d.innerHTML='\n        <div class="products-error" role="alert">\n          <p>Erro ao carregar acessórios. Por favor, recarregue a página.</p>\n        </div>\n      ')}}!function(){const e=[...document.querySelectorAll(".header-nav__link"),...document.querySelectorAll(".mobile-nav-bottom__link")],t=document.querySelectorAll('[id$="-section"]'),r=document.querySelector(".mobile-nav-bottom"),o=document.querySelector(".header-nav"),n=document.querySelector(".hero-carousel"),a=()=>isMobileDevice();function i(){if(!a())return r&&r.classList.remove("is-visible"),void(o&&(o.style.display=""));!n||n.getBoundingClientRect().bottom>.2*window.innerHeight||window.scrollY<100?(r&&r.classList.remove("is-visible"),o&&(o.style.display="",o.style.opacity="1")):(o&&(o.style.opacity="0",o.style.pointerEvents="none"),r&&r.classList.add("is-visible"))}function c(){const r=document.querySelector(".page-header"),o=r?r.offsetHeight:100,n=a()?o+50:o+100,i=window.scrollY+n;if(window.scrollY<100)return void e.forEach(e=>{e.classList.remove("header-nav__link--active","mobile-nav-bottom__link--active")});let c=!1;t.forEach(t=>{const r=t.offsetTop,o=t.offsetHeight,n=t.getAttribute("id");i>=r&&i<r+o&&e.forEach(e=>{e.classList.remove("header-nav__link--active","mobile-nav-bottom__link--active"),e.getAttribute("href")===`#${n}`&&(e.classList.add(e.classList.contains("mobile-nav-bottom__link")?"mobile-nav-bottom__link--active":"header-nav__link--active"),c=!0)})}),c||e.forEach(e=>{e.classList.remove("header-nav__link--active","mobile-nav-bottom__link--active")})}e.forEach(e=>{e.addEventListener("click",function(e){const t=this.getAttribute("href");if(t.startsWith("#")){e.preventDefault();const o=t.substring(1),n=document.getElementById(o);if(n){const e=document.querySelector(".page-header"),t=e?e.offsetHeight:100,o=a()&&r?r.offsetHeight:0,c=a()?t+o+20:t+20,s=n.getBoundingClientRect().top+window.pageYOffset-c;window.scrollTo({top:Math.max(0,s),behavior:"smooth"}),setTimeout(()=>{i()},100)}}})});let s=!1;const l=document.querySelector(".page-header");let d;window.addEventListener("scroll",()=>{s||(window.requestAnimationFrame(()=>{c(),i(),window.scrollY>50?l?.classList.add("scrolled"):l?.classList.remove("scrolled"),s=!1}),s=!0)}),window.addEventListener("resize",()=>{clearTimeout(d),d=setTimeout(()=>{i(),c()},150)}),c(),i(),window.scrollY>50&&l?.classList.add("scrolled")}(),currentYearEl&&(currentYearEl.textContent=(new Date).getFullYear());let carouselState={currentSlide:0,slides:[],autoplayInterval:null,autoplayDelay:5e3};async function loadHeroBanners(e=0){try{const e=await fetch("/data/banners.json",{cache:"no-cache",headers:{"Cache-Control":"no-cache"}});if(!e.ok)throw new Error(`Falha ao carregar banners: ${e.status} ${e.statusText}`);const t=(await e.json()).heroBanners.filter(e=>e.active).sort((e,t)=>e.order-t.order);if(0===t.length)return console.warn("[Banners] Nenhum banner ativo encontrado"),void showBannerFallback();carouselState.slides=t,renderHeroCarousel(t),initCarousel()}catch(t){console.error("[Banners] Erro ao carregar banners:",t),e<3?(console.log(`[Banners] Tentando novamente (${e+1}/3)...`),setTimeout(()=>{loadHeroBanners(e+1)},1e3*(e+1))):(console.error("[Banners] Todas as tentativas falharam. Mostrando fallback."),showBannerFallback())}}function showBannerFallback(){const e=document.querySelector(".hero-carousel__slides");e&&(e.children.length>0||(e.innerHTML='\n    <div class="hero-carousel__slide hero-carousel__slide--active" role="listitem">\n      <div style="display: flex; align-items: center; justify-content: center; height: 100%; background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%); color: white; padding: 2rem;">\n        <div style="text-align: center;">\n          <h2 style="margin: 0 0 1rem 0; font-size: 1.5rem;">Black Days RZ VET 2025</h2>\n          <p style="margin: 0; font-size: 1rem; opacity: 0.9;">As melhores promoções em equipamentos veterinários</p>\n        </div>\n      </div>\n    </div>\n  '))}function renderHeroCarousel(e){const t=document.querySelector(".hero-carousel__slides"),r=document.querySelector(".hero-carousel__indicators");t&&r&&(t.innerHTML="",r.innerHTML="",e.forEach((o,n)=>{const a=document.createElement("div");a.className="hero-carousel__slide "+(0===n?"hero-carousel__slide--active":""),a.setAttribute("role","listitem"),a.setAttribute("aria-hidden",0!==n?"true":"false"),a.dataset.slideIndex=n;const i=o.link?`<a href="${o.link}" class="hero-carousel__slide-link">`:"",c=o.link?"</a>":"",s=o.imageDesktop||o.image,l=o.imageMobile||o.image,d=isMobileDevice(),u=d?l:s;d&&!l&&console.warn(`[Banners] Banner ${o.id} não tem imagem mobile, usando desktop como fallback`),a.innerHTML=`\n      ${i}\n        <img \n          src="${u}" \n          alt="${o.alt}" \n          class="hero-carousel__slide-image"\n          data-desktop="${s}"\n          data-mobile="${l}"\n          loading="${0===n?"eager":"lazy"}"\n          decoding="async"\n          fetchpriority="${0===n?"high":"auto"}"\n        />\n        <div class="hero-carousel__slide-placeholder" style="display: none;" aria-hidden="true">\n          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">\n            <rect x="3" y="3" width="18" height="18" rx="2" />\n            <path d="M9 9h6v6H9z" />\n          </svg>\n          <p>Banner ${n+1}</p>\n        </div>\n      ${c}\n    `;const m=a.querySelector(".hero-carousel__slide-image");if(m&&(m.addEventListener("error",()=>{const e=a.querySelector(".hero-carousel__slide-placeholder");e&&(m.style.display="none",e.style.display="flex")}),0===n&&e.length>1)){const t=e[1],r=t.imageDesktop||t.image,o=t.imageMobile||t.image,n=isMobileDevice()?o:r;if(n){const e=document.createElement("link");e.rel="prefetch",e.as="image",e.href=n,document.head.appendChild(e)}}t.appendChild(a);const p=document.createElement("button");p.className="hero-carousel__indicator "+(0===n?"hero-carousel__indicator--active":""),p.setAttribute("type","button"),p.setAttribute("role","tab"),p.setAttribute("aria-label",`Ir para banner ${n+1}`),p.setAttribute("aria-selected",0===n?"true":"false"),p.dataset.slideIndex=n,p.addEventListener("click",()=>goToSlide(n)),r.appendChild(p)}))}function initCarousel(){const e=document.querySelector(".hero-carousel__prev"),t=document.querySelector(".hero-carousel__next"),r=document.querySelector(".hero-carousel");if(!e||!t||!r)return;e.addEventListener("click",()=>prevSlide()),t.addEventListener("click",()=>nextSlide()),r.addEventListener("mouseenter",()=>stopAutoplay()),r.addEventListener("mouseleave",()=>startAutoplay()),r.addEventListener("keydown",e=>{"ArrowLeft"===e.key?(e.preventDefault(),prevSlide()):"ArrowRight"===e.key&&(e.preventDefault(),nextSlide())});let o=0,n=0;r.addEventListener("touchstart",e=>{o=e.changedTouches[0].screenX}),r.addEventListener("touchend",e=>{n=e.changedTouches[0].screenX,function(){const e=50,t=o-n;Math.abs(t)>e&&(t>0?nextSlide():prevSlide())}()}),startAutoplay()}function nextSlide(){goToSlide((carouselState.currentSlide+1)%carouselState.slides.length)}function prevSlide(){goToSlide(0===carouselState.currentSlide?carouselState.slides.length-1:carouselState.currentSlide-1)}function goToSlide(e){if(e<0||e>=carouselState.slides.length)return;const t=document.querySelectorAll(".hero-carousel__slide"),r=document.querySelectorAll(".hero-carousel__indicator");t[carouselState.currentSlide]?.classList.remove("hero-carousel__slide--active"),t[carouselState.currentSlide]?.setAttribute("aria-hidden","true"),r[carouselState.currentSlide]?.classList.remove("hero-carousel__indicator--active"),r[carouselState.currentSlide]?.setAttribute("aria-selected","false"),carouselState.currentSlide=e,t[e]?.classList.add("hero-carousel__slide--active"),t[e]?.setAttribute("aria-hidden","false"),r[e]?.classList.add("hero-carousel__indicator--active"),r[e]?.setAttribute("aria-selected","true"),stopAutoplay(),startAutoplay()}function startAutoplay(){carouselState.autoplayInterval&&clearInterval(carouselState.autoplayInterval),carouselState.autoplayInterval=setInterval(()=>{nextSlide()},carouselState.autoplayDelay)}function stopAutoplay(){carouselState.autoplayInterval&&(clearInterval(carouselState.autoplayInterval),carouselState.autoplayInterval=null)}function updateBannerImagesOnResize(){const e=document.querySelectorAll(".hero-carousel__slide-image"),t=isMobileDevice();e.forEach(e=>{const r=e.dataset.desktop,o=e.dataset.mobile;if(!r||!o)return;const n=t?o:r,a=e.getAttribute("src");if(a!==n){a===o===t&&a===n||(e.src=n)}})}function initializeApp(){const e=()=>{loadProducts(),loadAccessories()};let t;initializeCountdowns(),loadHeroBanners(),window.requestIdleCallback?window.requestIdleCallback(e,{timeout:2e3}):setTimeout(e,100);let r=!1;window.addEventListener("resize",()=>{r||(r=!0,requestAnimationFrame(()=>{r=!1})),clearTimeout(t),t=setTimeout(()=>{updateBannerImagesOnResize(),mobileDeviceCache=null},200)}),window.addEventListener("orientationchange",()=>{mobileDeviceCache=null,setTimeout(()=>{updateBannerImagesOnResize()},200)})}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",initializeApp,{once:!0}):window.requestAnimationFrame?window.requestAnimationFrame(initializeApp):setTimeout(initializeApp,0);