const form=document.querySelector("#form-waitlist"),statusBox=document.querySelector("#form-status"),submitButton=form?.querySelector('button[type="submit"]'),telefoneInput=form?.querySelector("#telefone"),currentYearEl=document.querySelector("#current-year"),customSelectInstances=new Set,productInterestInputs=Array.from(document.querySelectorAll('input[name="produtos_interesse"]')),countdownControllers=new WeakMap,API_BASE_URL=window.API_BASE_URL??"/api",COUNTDOWN_TIME_ZONE="America/Sao_Paulo";currentYearEl&&(currentYearEl.textContent=(new Date).getFullYear());let formViewed=!1;if(void 0!==window.fbq){const e=document.querySelector(".form-section");if(e){const t=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&!formViewed&&(window.fbq("track","ViewContent",{content_name:"Formulário Black Days RZ VET",content_category:"Lead Form",content_type:"form"}),formViewed=!0,t.disconnect())})},{threshold:.5});t.observe(e)}}function showStatus(e,{isError:t=!1}={}){statusBox&&(statusBox.textContent=e,statusBox.classList.add("is-visible"),statusBox.classList.toggle("is-success",!t),statusBox.classList.toggle("is-error",t))}function clearStatus(){statusBox&&(statusBox.textContent="",statusBox.classList.remove("is-visible","is-success","is-error"))}function enhanceSelect(e){if(!e)return;if("true"===e.dataset.enhanced)return;const t=document.createElement("div");t.className="custom-select";const n=document.createElement("button");n.type="button",n.className="custom-select__trigger",n.setAttribute("aria-haspopup","listbox"),n.setAttribute("aria-expanded","false");const s=document.createElement("span");s.className="custom-select__value",n.appendChild(s);const a=document.createElement("span");a.className="custom-select__arrow",n.appendChild(a);const o=document.createElement("ul");o.className="custom-select__list",o.setAttribute("role","listbox"),o.tabIndex=-1;const r=Array.from(e.options).map((t,n)=>{const s=document.createElement("li");return s.className="custom-select__option",s.dataset.value=t.value,s.textContent=t.textContent,s.setAttribute("role","option"),s.id=`${e.id||"select"}-option-${n}`,t.disabled&&s.setAttribute("aria-disabled","true"),t.selected?(s.classList.add("is-selected"),s.setAttribute("aria-selected","true")):s.setAttribute("aria-selected","false"),o.appendChild(s),s});e.parentNode.insertBefore(t,e),t.append(n,o,e),e.classList.add("custom-select__native"),e.setAttribute("tabindex","-1"),e.dataset.enhanced="true";let i=-1;function c(){return r.filter(e=>"true"!==e.getAttribute("aria-disabled"))}function l(e){const a=r.find(t=>t.dataset.value===e&&"true"!==t.getAttribute("aria-disabled"));r.forEach(e=>{const t=e===a;e.classList.toggle("is-selected",t),e.setAttribute("aria-selected",t?"true":"false")});const o=a??r[0];o&&(s.textContent=o.textContent);const l=c(),u=a?.dataset.value??"",d=l.findIndex(e=>e.dataset.value===u);-1!==d&&(i=d),t.classList.toggle("is-placeholder",!e),t.classList.remove("has-error"),n.removeAttribute("aria-invalid")}function u(){i=-1;c().forEach(e=>{e.classList.remove("is-active")}),o.removeAttribute("aria-activedescendant")}function d(e){const t=c();if(!t.length)return;const n=(e%t.length+t.length)%t.length;i=n,t.forEach((e,t)=>{e.classList.toggle("is-active",t===n)});const s=t[n];s&&(o.setAttribute("aria-activedescendant",s.id),s.scrollIntoView({block:"nearest"}))}function m(e=!1){t.classList.contains("is-open")&&(t.classList.remove("is-open"),n.setAttribute("aria-expanded","false"),u(),e&&n.focus())}function f({alignWithCurrent:s=!1}={}){if(!t.classList.contains("is-open")){if(t.classList.add("is-open"),n.setAttribute("aria-expanded","true"),s){const t=e.value,n=c().findIndex(e=>e.dataset.value===t);-1!==n?d(n):u()}else u();window.requestAnimationFrame(()=>{o.focus()})}}function p(t){if(!t||"true"===t.getAttribute("aria-disabled"))return;const n=e.value;e.value=t.dataset.value,n!==e.value?e.dispatchEvent(new Event("change",{bubbles:!0})):l(e.value),m(!0)}function h(e){const n=c();if(n.length)switch(e.key){case"ArrowDown":case"Down":e.preventDefault(),t.classList.contains("is-open")||f({alignWithCurrent:!0}),d(-1===i?0:i+1);break;case"ArrowUp":case"Up":e.preventDefault(),t.classList.contains("is-open")||f({alignWithCurrent:!0}),d(-1===i?n.length-1:i-1);break;case"Home":e.preventDefault(),t.classList.contains("is-open")||f({alignWithCurrent:!0}),d(0);break;case"End":e.preventDefault(),t.classList.contains("is-open")||f({alignWithCurrent:!0}),d(n.length-1);break;case" ":case"Enter":if(e.preventDefault(),t.classList.contains("is-open")){p(n[i])}else f({alignWithCurrent:!0});break;case"Tab":t.classList.contains("is-open")&&m();break;case"Escape":t.classList.contains("is-open")&&(e.preventDefault(),m(!0))}}n.addEventListener("click",()=>{t.classList.contains("is-open")?m(!0):f()}),o.addEventListener("click",e=>{const t=e.target.closest(".custom-select__option");t&&(e.preventDefault(),p(t))}),n.addEventListener("keydown",h),o.addEventListener("keydown",h),e.addEventListener("change",()=>{l(e.value)}),e.addEventListener("invalid",e=>{e.preventDefault(),t.classList.add("has-error"),n.setAttribute("aria-invalid","true"),n.focus()}),e.form&&e.form.addEventListener("reset",()=>{window.requestAnimationFrame(()=>{l(e.value)})}),l(e.value),customSelectInstances.add({wrapper:t,close:(e=!1)=>m(e),isOpen:()=>t.classList.contains("is-open")})}function getTimeZoneOffsetMs(e,t){const n=new Intl.DateTimeFormat("en-US",{timeZone:t,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hourCycle:"h23"}).formatToParts(e).reduce((e,t)=>("literal"!==t.type&&(e[t.type]=t.value),e),{});return Date.UTC(Number(n.year),Number(n.month)-1,Number(n.day),Number(n.hour),Number(n.minute),Number(n.second))-e.getTime()}function parseCountdownTarget(e,t){if(!e)return null;const n=e.trim();if(!n)return null;if(/([zZ]|[+-]\d\d:\d\d)$/.test(n)){const e=new Date(n);return Number.isNaN(e.getTime())?null:e}const[s,a="00:00:00"]=n.replace(/\s+/,"T").split("T");if(!s)return null;const[o,r="01",i="01"]=s.split("-"),[c="00",l="00",u="00"]=a.split(":"),d=[Number(o),Number(r),Number(i),Number(c),Number(l),Number(u)];if(d.some(e=>Number.isNaN(e)))return null;const[m,f,p,h,b,v]=d,g=new Date(Date.UTC(m,f-1,p,h,b,v)),w=getTimeZoneOffsetMs(g,t);return new Date(g.getTime()-w)}function initializeCountdowns(){const e=document.querySelectorAll("[data-target-date]");e.length&&e.forEach(e=>{if(countdownControllers.has(e))return;const t=e.dataset.targetDate;if(!t)return;const n=parseCountdownTarget(t,"America/Sao_Paulo");if(Number.isNaN(n.getTime()))return;const s={days:e.querySelector('[data-countdown-part="days"]'),hours:e.querySelector('[data-countdown-part="hours"]'),minutes:e.querySelector('[data-countdown-part="minutes"]'),seconds:e.querySelector('[data-countdown-part="seconds"]')};if(!Object.values(s).every(Boolean))return;function a(e,t=2){return String(Math.max(0,e)).padStart(t,"0")}function o(){const t=new Date;let o=n.getTime()-t.getTime();o<0&&(o=0);const r=Math.floor(o/1e3),i=Math.floor(r/86400),c=Math.floor(r%86400/3600),l=Math.floor(r%3600/60),u=r%60;if(s.days.textContent=a(i,2),s.hours.textContent=a(c),s.minutes.textContent=a(l),s.seconds.textContent=a(u),e.dataset.countdownState=0===o?"finished":"running",e.setAttribute("aria-label",0===o?"Evento iniciado":`Faltam ${i} dias, ${c} horas, ${l} minutos e ${u} segundos`),0===o){const t=countdownControllers.get(e);t&&window.clearInterval(t)}}o();const r=window.setInterval(o,1e3);countdownControllers.set(e,r)})}function formatPhone(e=""){const t=e.replace(/\D/g,"").slice(0,11);return t.length<=2?t:t.length<=6?`(${t.slice(0,2)}) ${t.slice(2)}`.trim():t.length<=10?`(${t.slice(0,2)}) ${t.slice(2,6)}-${t.slice(6)}`:`(${t.slice(0,2)}) ${t.slice(2,7)}-${t.slice(7)}`}function handlePhoneInput(e){const t=e.target,n=t.selectionStart??0,s=t.value.slice(0,n).replace(/\D/g,"");t.value=formatPhone(t.value);let a=t.value.length,o=0;for(let e=0;e<t.value.length;e+=1)if(/\d/.test(t.value[e])&&(o+=1),o===s.length){a=e+1;break}t.setSelectionRange(a,a)}function setProductInterestPressed(e){const t=e.closest(".inline-option");t&&t.setAttribute("aria-pressed",e.checked?"true":"false")}function setupProductInterestControls(){productInterestInputs.forEach(e=>{setProductInterestPressed(e),e.addEventListener("change",()=>setProductInterestPressed(e))})}async function handleSubmit(e){if(e.preventDefault(),clearStatus(),!form)return;if(!form.checkValidity())return void form.reportValidity();const t=new FormData(form),n=Object.fromEntries(t.entries()),s=Array.from(new Set(t.getAll("produtos_interesse").filter(Boolean)));s.length?n.produtos_interesse=s:delete n.produtos_interesse;try{submitButton?.setAttribute("disabled","true");const e=await fetch(`${API_BASE_URL}/leads`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!e.ok){const{message:t}=await e.json().catch(()=>({message:"Erro desconhecido"}));throw new Error(t||"Falha ao enviar. Tente novamente.")}if(void 0!==window.fbq){const e=s.length||1;window.fbq("track","Lead",{content_name:"Black Days RZ VET 2025",content_category:"Equipamentos Veterinários",value:100*e,currency:"BRL",status:"completed"}),window.fbq("track","CompleteRegistration",{content_name:"Cadastro Lista VIP Black Days",status:"completed"})}form.reset(),updateSelectedSelects(),window.requestAnimationFrame(()=>{productInterestInputs.forEach(setProductInterestPressed)}),showStatus("Obrigado! Seu nome está na lista.",{isError:!1})}catch(e){let t="Ops! Algo deu errado. Tente novamente.";e instanceof TypeError&&"Failed to fetch"===e.message?t="Não foi possível conectar à API. Verifique se o servidor está rodando.":e.message&&(t=e.message),showStatus(t,{isError:!0})}finally{submitButton?.removeAttribute("disabled")}}function updateSelectedSelects(){customSelectInstances.forEach(e=>{const t=e.wrapper.querySelector(".custom-select__native");t&&(t.value="",t.dispatchEvent(new Event("change",{bubbles:!0})),e.close(),e.wrapper.classList.add("is-placeholder"))})}document.addEventListener("click",e=>{customSelectInstances.forEach(t=>{t.wrapper.contains(e.target)||t.close()})}),document.addEventListener("keydown",e=>{if("Escape"!==e.key)return;let t=!1;customSelectInstances.forEach(e=>{e.isOpen()&&(e.close(!0),t=!0)}),t&&e.preventDefault()}),telefoneInput&&telefoneInput.addEventListener("input",handlePhoneInput),initializeCountdowns(),form&&form.addEventListener("submit",handleSubmit);const atuacaoSelect=document.querySelector("#atuacao");atuacaoSelect&&enhanceSelect(atuacaoSelect),setupProductInterestControls();